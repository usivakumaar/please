<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Hello OpenCV.js</title>
</head>
<body>
<h2>Demo OpenCV.js</h2>
<p id="status">OpenCV.js is loading...</p>
<div>
  <div class="inputoutput">
    <img id="imageSrc" alt="No Image" />
    <img id="imageSrc1" alt="No Image" />
    <div class="caption">imageSrc <input type="file" id="fileInput" name="file" />
        <input type="file" id="fileInput1" name="file" />
    </div>
  </div>
  <div class="inputoutput">
    <canvas id="canvasOutput" ></canvas>
    <div class="caption">canvasOutput</div>
  </div>
</div>



<script type="text/javascript">
let imgElement = document.getElementById('imageSrc');
let imgElement1 = document.getElementById('imageSrc1');
let inputElement = document.getElementById('fileInput');
let inputElement1 = document.getElementById('fileInput1');
inputElement.addEventListener('change', (e) => {
  imgElement.src = URL.createObjectURL(e.target.files[0]);
}, false);

inputElement1.addEventListener('change', (e) => {
  imgElement1.src = URL.createObjectURL(e.target.files[0]);
}, false);

imgElement.onload = function() {
  // let mat = cv.imread(imgElement);
  
  let src = cv.imread(imgElement);
let templ = cv.imread(imgElement1);
let dst = new cv.Mat();
let mask = new cv.Mat();
cv.cvtColor(src,dst, cv.COLOR_BGR2GRAY,0);
cv.Canny(src, dst, 50, 100, 3, false);
cv.matchTemplate(src, templ, dst, cv.TM_CCOEFF, mask);
let result = cv.minMaxLoc(dst, mask);
let maxPoint = result.maxLoc;
let color = new cv.Scalar(255, 0, 0, 255);
let point = new cv.Point(maxPoint.x + templ.cols, maxPoint.y + templ.rows);
cv.rectangle(src, maxPoint, point, color, 2, cv.LINE_8, 0);
cv.imshow('canvasOutput', src);
src.delete(); dst.delete(); mask.delete();


// let src = cv.imread(imgElement);
// let dst = cv.Mat.zeros(src.cols, src.rows, cv.CV_8UC3);
// cv.cvtColor(src, src, cv.COLOR_RGBA2GRAY, 0);
// cv.threshold(src, src, 120, 200, cv.THRESH_BINARY);
// let contours = new cv.MatVector();
// let hierarchy = new cv.Mat();
// // You can try more different parameters
// cv.findContours(src, contours, hierarchy, cv.RETR_CCOMP, cv.CHAIN_APPROX_SIMPLE);
// // draw contours with random Scalar
// for (let i = 0; i < contours.size(); ++i) {
//     let color = new cv.Scalar(Math.round(Math.random() * 255), Math.round(Math.random() * 255),
//                               Math.round(Math.random() * 255));
//     cv.drawContours(dst, contours, i, color, 1, cv.LINE_8, hierarchy, 100);
// }
// cv.imshow('canvasOutput', dst);
// src.delete(); dst.delete(); contours.delete(); hierarchy.delete();



// let src = cv.imread(imgElement);
// let dst = new cv.Mat();
// cv.cvtColor(src, src, cv.COLOR_RGB2GRAY, 0);
// cv.Canny(src, dst, 50, 100, 3, false);
// cv.imshow('canvasOutput', dst);
// src.delete(); dst.delete();
  

//imgElement.convertTo('canvasOutput', -1, 2.2, 50);
//  cv.cvtColor(mat, cv.COLOR_BGR2GRAY)
//  cv.imshow('canvasOutput', mat);
 // cv.resize(mat, 'canvasOutput', 'interpolation=CV_INTER_LINEAR'); 
  // mat.delete();
};
function onOpenCvReady() {
  document.getElementById('status').innerHTML = 'OpenCV.js is ready.';
 // init();
}




</script>

<script async src="js/opencv.js" onload="onOpenCvReady();" type="text/javascript"></script>
</body>
</html>